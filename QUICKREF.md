# BC-Bio-Visualizer 快速参考指南

> 这是一份简明的快速参考指南。详细的架构和功能说明请参阅 [ARCHITECTURE.md](./ARCHITECTURE.md)

---

## 📋 目录
- [快速开始](#快速开始)
- [核心功能](#核心功能)
- [常用操作](#常用操作)
- [快捷键](#快捷键)
- [数据格式](#数据格式)
- [常见问题](#常见问题)

---

## 🚀 快速开始

### 1. 提取数据（console-profiles.js）

```javascript
// 1. 在包含 bce-past-profiles 数据库的页面打开控制台 (F12)
// 2. 粘贴并运行 console-profiles.js
// 3. 等待脚本完成（会自动下载 JSON 文件）
```

**输出文件**：`testprofiles.extracted.json`

### 2. 可视化数据（bc-graph-viewer.html）

```
1. 打开 bc-graph-viewer.html
2. 点击 "选择文件" 按钮
3. 选择 testprofiles.extracted.json
4. 开始探索！
```

---

## 🎯 核心功能

### 文件管理
| 功能 | 说明 |
|-----|------|
| **导入 JSON** | 加载角色数据文件（支持多选合并） |
| **导出分组** | 保存标注数据到 marks-export.json |
| **导入分组** | 加载之前保存的标注数据 |

### 搜索与筛选
| 功能 | 说明 |
|-----|------|
| **搜索框** | 按姓名、昵称、ID 搜索 |
| **头衔筛选** | 按角色头衔过滤 |
| **显示昵称** | 切换显示姓名/昵称 |
| **显示主仆** | 切换主仆关系线 |
| **显示恋爱** | 切换恋爱关系线 |
| **隐藏孤立** | 隐藏无连接的节点 |

### 分组管理
| 操作 | 说明 |
|-----|------|
| **创建分组** | 点击"新建分组"按钮 |
| **分配节点** | 选择节点后在右侧面板选择分组 |
| **编辑分组** | 点击分组的编辑按钮 ✏️ |
| **删除分组** | 点击分组的删除按钮 🗑️ |
| **分组高亮** | 同组节点自动高亮显示 |

### 圈子管理
| 操作 | 说明 |
|-----|------|
| **创建圈子** | 点击"新建圈子"按钮 |
| **分配节点** | 选择节点后勾选圈子 |
| **层级拖拽** | 拖动圈子调整父子关系 |
| **显示圈子** | 勾选"显示选中圈子" |
| **圈子轮廓** | 显示圈子成员的包围轮廓 |

### 图形控制
| 操作 | 说明 |
|-----|------|
| **物理切换** | 开启/关闭布局物理引擎（空格键） |
| **适配视图** | 自动调整缩放以显示所有节点 |
| **拖动节点** | 手动调整节点位置 |
| **双击固定** | 固定节点位置（不受物理影响） |
| **滚轮缩放** | 缩放视图 |
| **拖动画布** | 平移视图 |

---

## 🎨 常用操作

### 查看节点详情

```
1. 单击节点 → 右侧面板显示详细信息
2. 查看：姓名、昵称、头衔、描述、关系等
```

### 创建分组并标记节点

```
1. 选择一个节点
2. 右侧面板 → 分组设置 → 新建分组
3. 输入分组名称 → 点击 ✓
4. 选择其他节点 → 选择刚创建的分组
5. 同组节点会自动连接和高亮
```

### 定义圈子层级

```
1. 创建父圈子（如"核心圈"）
2. 创建子圈子（如"密友圈"）
3. 拖动子圈子到父圈子的"拖到此处设为子圈"区域
4. 节点勾选子圈子会自动继承父圈子
```

### 搜索并定位节点

```
1. 在搜索框输入关键词
2. 图形自动筛选匹配节点
3. 点击左侧列表中的节点名
4. 视图自动聚焦到该节点
```

### 查看特定圈子成员

```
1. 左侧面板 → 显示圈子
2. 勾选"显示选中圈子"
3. 勾选要查看的圈子
4. 图形仅显示圈子成员及其关系
```

### 调整布局

```
方法1：物理引擎自动布局
  1. 点击"开始物理"（或按空格）
  2. 等待布局稳定
  3. 再次按空格停止

方法2：手动调整
  1. 停止物理
  2. 拖动节点到理想位置
  3. 双击节点固定位置
```

### 导出并保存工作

```
1. 标记完所有分组和圈子
2. 点击"导出分组"
3. 保存 marks-export.json
4. 下次使用"导入分组"恢复标注
```

---

## ⌨️ 快捷键

| 按键 | 功能 |
|-----|------|
| **空格** | 切换物理引擎开关 |
| **鼠标滚轮** | 缩放视图 |
| **拖动画布** | 平移视图 |
| **双击节点** | 固定/取消固定节点 |
| **单击节点** | 选择并查看详情 |

---

## 📊 数据格式

### 输入数据格式（testprofiles.extracted.json）

```json
[
  {
    "memberNumber": 123456,
    "name": "角色名",
    "nickname": "昵称",
    "lastNick": "最后昵称",
    "seen": "2024-01-01T00:00:00.000Z",
    "title": "头衔",
    "assetFamily": "资产家族",
    "ownership": {
      "Name": "主人名",
      "MemberNumber": 789012
    },
    "lovership": [
      {
        "Name": "恋人名",
        "MemberNumber": 345678
      }
    ],
    "descriptionDecoded": "角色描述文本",
    "descriptionRaw": "原始压缩数据"
  }
]
```

### 标注数据格式（marks-export.json）

```json
{
  "groups": {
    "group-uuid-1": {
      "name": "分组名",
      "color": "#6ac9ff"
    }
  },
  "circles": {
    "circle-uuid-1": {
      "name": "圈子名",
      "children": ["circle-uuid-2"]
    }
  },
  "nodeToGroup": {
    "123456": "group-uuid-1"
  },
  "nodeToCircles": {
    "123456": ["circle-uuid-1"]
  }
}
```

---

## ❓ 常见问题

### Q: 如何合并多个数据文件？
**A**: 在文件选择对话框中按住 Ctrl/Cmd 多选文件，应用会自动合并去重。

### Q: 标注数据保存在哪里？
**A**: 
- 自动保存到浏览器 LocalStorage
- 手动导出到 marks-export.json 文件

### Q: 如何恢复之前的标注？
**A**: 点击"导入分组"按钮，选择之前导出的 marks-export.json 文件。

### Q: 节点太多图形很乱怎么办？
**A**: 
1. 使用搜索和筛选功能
2. 勾选"隐藏孤立"减少无关节点
3. 使用圈子过滤只显示特定群体
4. 开启物理引擎自动优化布局

### Q: 如何查看某个角色的所有关系？
**A**: 
1. 搜索该角色
2. 单击节点查看详情
3. 右侧面板显示主仆和恋爱关系
4. 图形中高亮显示直接连接

### Q: 圈子轮廓没有显示？
**A**: 
1. 确认勾选"显示圈子轮廓"
2. 圈子至少需要2个成员才显示轮廓
3. 检查圈子成员是否在当前筛选范围内

### Q: 分组颜色可以自定义吗？
**A**: 当前版本使用自动生成的颜色，未来版本会支持自定义。

### Q: 如何撤销误操作？
**A**: 
- 分组/圈子：删除后重新创建
- 节点标注：重新分配或清除
- 导入错误数据：刷新页面恢复到上次状态
- 建议定期导出备份

### Q: 物理引擎卡住不动？
**A**: 
1. 按空格键停止物理
2. 手动拖动几个关键节点
3. 再次启动物理引擎
4. 如果节点太多，考虑筛选后再启动

### Q: 如何查看最新的代码或贡献？
**A**: 查看 GitHub 仓库（如果有的话）或联系项目维护者。

---

## 🔧 技术栈

| 组件 | 技术 |
|-----|------|
| **数据提取** | JavaScript (async/await, IndexedDB) |
| **可视化** | vis-network.js |
| **数据存储** | LocalStorage, JSON |
| **压缩解码** | lz-string.js |
| **样式** | 纯 CSS（深色主题） |

---

## 📚 相关文档

- **[ARCHITECTURE.md](./ARCHITECTURE.md)** - 详细架构与功能说明
- **[README.md](./README.md)** - 项目简介

---

## 🎓 使用技巧

### 提示 1：分层管理大型网络
```
1. 先创建核心分组（如"核心成员"、"外围成员"）
2. 再创建圈子层级（父圈子 → 子圈子）
3. 使用圈子过滤逐层查看
```

### 提示 2：快速标记相关人员
```
1. 搜索目标角色
2. 为其创建分组
3. 点击其关系节点，快速分配到同一分组
```

### 提示 3：导出前备份
```
定期导出分组数据，避免清除浏览器数据导致丢失
```

### 提示 4：多文件工作流
```
1. 原始数据：testprofiles.extracted.json（定期更新）
2. 标注数据：marks-export.json（增量维护）
3. 每次加载：先导入数据，再导入标注
```

### 提示 5：性能优化
```
- 大数据集（>1000 节点）：优先使用筛选和搜索
- 关闭圈子轮廓可提升渲染性能
- 停止物理引擎后交互更流畅
```

---

**更新日期**：2026-02-13  
**版本**：1.0
