# BC-Bio-Visualizer Tampermonkey 迁移进度

**开始时间**: 2026-02-13  
**当前版本**: v2.0.0 (开发中)  
**状态**: 🚧 进行中

---

## 总体进度

```
阶段1: ████████████████████ 100% 完成 ✅
阶段2: ████████████████████ 100% 完成 ✅
阶段3: ░░░░░░░░░░░░░░░░░░░░   0% 待开始
阶段4: ░░░░░░░░░░░░░░░░░░░░   0% 待开始
阶段5: ░░░░░░░░░░░░░░░░░░░░   0% 待开始
阶段6: ░░░░░░░░░░░░░░░░░░░░   0% 待开始
阶段7: ░░░░░░░░░░░░░░░░░░░░   0% 待开始
阶段8: ░░░░░░░░░░░░░░░░░░░░   0% 待开始

总进度: 25% (2/8 阶段完成)
```

---

## 阶段 1：基础架构搭建 ✅

**状态**: ✅ 完成  
**完成时间**: 2026-02-13 16:40

### 任务清单

- [x] 1.1 创建 `bc-bio-visualizer.user.js` 文件
- [x] 1.2 编写 Tampermonkey 元数据头部
  - [x] 定义 `@match` 匹配目标网站
  - [x] 声明 `@grant` 权限
  - [x] 添加 `@require` 依赖库
- [x] 1.3 实现 Shadow DOM 容器创建函数
- [x] 1.4 设计浮动触发按钮UI
- [x] 1.5 实现界面显示/隐藏切换逻辑

### 完成功能

✅ Tampermonkey 脚本元数据配置完成
- `@match` 两个目标网站
- `@grant` 完整权限声明
- `@require` vis-network 和 LZString

✅ 浮动按钮实现
- 右下角固定位置
- 渐变背景样式
- 悬停动画效果

✅ Shadow DOM 容器
- 完整样式隔离
- 全屏覆盖层
- 显示/隐藏切换

✅ 工具函数
- debounce / throttle
- hashOffset (哈希偏移)
- Storage 封装 (GM API)

### 测试结果

- ✅ 脚本可正常安装
- ✅ 浮动按钮显示正常
- ✅ 点击按钮弹出容器
- ✅ Shadow DOM 工作正常
- ✅ 样式完全隔离

---

## 阶段 2：数据提取模块迁移 ✅

**状态**: ✅ 完成  
**完成时间**: 2026-02-13 16:40

### 任务清单

- [x] 2.1 将 `console-profiles.js` 封装为模块函数
- [x] 2.2 实现 `extractDataFromIndexedDB()` 函数
- [x] 2.3 添加数据提取进度UI
- [x] 2.4 实现错误处理和重试逻辑
- [x] 2.5 缓存提取的数据（避免重复提取）

### 完成功能

✅ 数据提取核心函数
- `readAllFromStore()` - 读取IndexedDB
- `decodeDescription()` - 解码压缩描述
- `pickBasicInfo()` - 提取基本信息
- `extractDataFromIndexedDB()` - 主提取函数

✅ 进度提示系统
- 加载覆盖层 (loading overlay)
- 动画旋转图标
- 实时进度消息更新

✅ 数据缓存机制
- `getData()` 函数实现缓存
- 5分钟缓存时长
- 强制刷新选项

✅ 错误处理
- try-catch 包裹
- 用户友好的错误提示
- 控制台错误日志

### 测试结果

- ✅ 可成功读取 IndexedDB
- ✅ 数据解码正确
- ✅ 进度提示正常显示
- ✅ 缓存机制工作正常
- ✅ 错误处理友好

---

## 阶段 3：可视化界面迁移 🚧

**状态**: 🚧 待开始  
**预计开始**: 下一次迭代

### 任务清单

- [ ] 3.1 提取 bc-graph-viewer.html 的完整 HTML 结构
- [ ] 3.2 转换为 JavaScript 模板字符串
- [ ] 3.3 提取所有 CSS 样式 (3000+ 行)
- [ ] 3.4 注入到 Shadow DOM
- [ ] 3.5 验证界面显示正常
- [ ] 3.6 测试布局和响应式

### 待实现功能

- 完整的三栏布局
- 左侧筛选面板
- 中央图形区域
- 右侧详情面板
- 工具栏所有按钮
- 拖拽分隔器

---

## 阶段 4：核心功能迁移 📋

**状态**: 📋 待开始

### 任务清单

- [ ] 4.1 迁移 `computeGraph()` 图形计算函数
- [ ] 4.2 迁移 vis-network 初始化代码
- [ ] 4.3 迁移事件监听器 (点击、搜索、筛选)
- [ ] 4.4 迁移分组和圈子管理功能
- [ ] 4.5 迁移凸包算法和绘制逻辑
- [ ] 4.6 适配 LocalStorage → GM API

### 待迁移的关键函数

- `computeGraph()` - 图形计算
- `applyFilters()` - 应用筛选
- `renderGroupSelect()` - 渲染分组选择器
- `buildCircleForest()` - 构建圈子树
- `convexHull()` - 凸包算法
- `expandPolygon()` - 多边形扩展
- `buildRoundedPath()` - 圆角路径

---

## 阶段 5：数据持久化适配 📋

**状态**: 📋 待开始

### 任务清单

- [ ] 5.1 替换所有 `localStorage` 调用为 GM API
- [ ] 5.2 实现数据导出功能 (下载JSON)
- [ ] 5.3 实现数据导入功能 (文件选择)
- [ ] 5.4 添加数据同步/备份提示
- [ ] 5.5 处理存储配额和错误

---

## 阶段 6：用户体验优化 📋

**状态**: 📋 待开始

### 任务清单

- [ ] 6.1 添加加载动画和进度提示
- [ ] 6.2 实现快捷键支持 (Ctrl+Shift+V 唤起)
- [ ] 6.3 优化首次加载性能
- [ ] 6.4 添加错误提示和帮助文档
- [ ] 6.5 实现界面尺寸记忆
- [ ] 6.6 添加主题切换 (可选)

---

## 阶段 7：测试与质量保障 📋

**状态**: 📋 待开始

### 测试清单

- [ ] 功能完整性测试
  - [ ] 数据提取准确性
  - [ ] 图形渲染正确性
  - [ ] 搜索筛选功能
  - [ ] 分组圈子管理
  - [ ] 数据导入导出
- [ ] 兼容性测试
  - [ ] Chrome + Tampermonkey
  - [ ] Firefox + Tampermonkey
  - [ ] Edge + Tampermonkey
  - [ ] Safari (Userscripts)
- [ ] 性能测试
  - [ ] 大数据集 (1000+ 节点)
  - [ ] 内存占用监控
  - [ ] 渲染帧率测试

---

## 阶段 8：文档编写与发布 📋

**状态**: 📋 待开始

### 任务清单

- [ ] 8.1 编写用户安装指南
- [ ] 8.2 编写使用教程 (图文/视频)
- [ ] 8.3 更新 README.md
- [ ] 8.4 添加 CHANGELOG.md
- [ ] 8.5 创建 GitHub Release
- [ ] 8.6 发布到 Greasy Fork (可选)
- [ ] 8.7 发布到 OpenUserJS (可选)

---

## 当前工作文件

### 已创建
- ✅ `bc-bio-visualizer.user.js` - 主脚本文件 (已创建)
- ✅ `MIGRATION_PLAN.md` - 迁移计划文档
- ✅ `迁移进度.md` - 本文件

### 保持不变
- ✅ `ARCHITECTURE.md` - 架构文档 (不改动)
- ✅ `README.md` - 项目说明 (不改动)
- ✅ `QUICKREF.md` - 快速参考 (不改动)
- ✅ `bc-graph-viewer.html` - 原HTML文件 (保留)
- ✅ `console-profiles.js` - 原控制台脚本 (保留)

---

## 已知问题

### 待解决
- 暂无

### 已解决
- ✅ Tampermonkey 元数据配置
- ✅ Shadow DOM 样式隔离
- ✅ 数据提取功能实现

---

## 开发日志

### 2026-02-13

**16:40 - 阶段1和阶段2完成**
- ✅ 创建 Tampermonkey 脚本文件
- ✅ 实现基础架构 (浮动按钮、Shadow DOM)
- ✅ 实现数据提取模块 (IndexedDB 读取、解码)
- ✅ 添加进度提示和缓存机制
- ✅ 实现基础UI界面
- ✅ 测试通过：脚本可正常运行，数据提取成功

**当前代码行数**: ~700 行

**下一步计划**:
1. 提取完整的 HTML 结构和 CSS 样式
2. 迁移可视化界面到 Shadow DOM
3. 实现 vis-network 图形渲染

---

## 里程碑

- [x] **Milestone 1**: 基础框架搭建 (2026-02-13) ✅
- [x] **Milestone 2**: 数据提取功能 (2026-02-13) ✅
- [ ] **Milestone 3**: 界面完整迁移
- [ ] **Milestone 4**: 核心功能实现
- [ ] **Milestone 5**: 测试通过
- [ ] **Milestone 6**: 正式发布

---

## 参考资料

- [MIGRATION_PLAN.md](./MIGRATION_PLAN.md) - 详细迁移计划
- [ARCHITECTURE.md](./ARCHITECTURE.md) - 原架构文档
- [bc-graph-viewer.html](./bc-graph-viewer.html) - 原可视化界面
- [console-profiles.js](./console-profiles.js) - 原数据提取脚本

---

**最后更新**: 2026-02-13 16:40  
**维护者**: BC-Bio-Visualizer Team
